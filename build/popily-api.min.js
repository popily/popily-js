!function e(r,t,o){function n(s,a){if(!t[s]){if(!r[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=t[s]={exports:{}};r[s][0].call(c.exports,function(e){var t=r[s][1][e];return n(t?t:e)},c,c.exports,e,r,t,o)}return t[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)n(o[s]);return n}({1:[function(e,r,t){!function(e,o){"function"==typeof define&&define.amd?define([],o):"object"==typeof t?r.exports=o():e.returnExports=o()}(this,function(){function e(n,i){if("function"!=typeof i)throw new Error("Bad callback given: "+i);if(!n)throw new Error("No options given");var a=n.onResponse;if(n="string"==typeof n?{uri:n}:JSON.parse(JSON.stringify(n)),n.onResponse=a,n.verbose&&(e.log=o()),n.url&&(n.uri=n.url,delete n.url),!n.uri&&""!==n.uri)throw new Error("options.uri is a required argument");if("string"!=typeof n.uri)throw new Error("options.uri must be a string");for(var u=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],c=0;c<u.length;c++)if(n[u[c]])throw new Error("options."+u[c]+" is not supported");if(n.callback=i,n.method=n.method||"GET",n.headers=n.headers||{},n.body=n.body||null,n.timeout=n.timeout||e.DEFAULT_TIMEOUT,n.headers.host)throw new Error("Options.headers.host is not supported");n.json&&(n.headers.accept=n.headers.accept||"application/json","GET"!==n.method&&(n.headers["content-type"]="application/json"),"boolean"!=typeof n.json?n.body=JSON.stringify(n.json):"string"!=typeof n.body&&(n.body=JSON.stringify(n.body)));var d=function(e){var r=[];for(var t in e)e.hasOwnProperty(t)&&r.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return r.join("&")};if(n.qs){var f="string"==typeof n.qs?n.qs:d(n.qs);-1!==n.uri.indexOf("?")?n.uri=n.uri+"&"+f:n.uri=n.uri+"?"+f}var l=function(e){var r={};r.boundry="-------------------------------"+Math.floor(1e9*Math.random());var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push("--"+r.boundry+'\nContent-Disposition: form-data; name="'+o+'"\n\n'+e[o]+"\n");return t.push("--"+r.boundry+"--"),r.body=t.join(""),r.length=r.body.length,r.type="multipart/form-data; boundary="+r.boundry,r};if(n.form){if("string"==typeof n.form)throw"form name unsupported";if("POST"===n.method){var p=(n.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(n.headers["content-type"]=p,p){case"application/x-www-form-urlencoded":n.body=d(n.form).replace(/%20/g,"+");break;case"multipart/form-data":var h=l(n.form);n.body=h.body,n.headers["content-type"]=h.type;break;default:throw new Error("unsupported encoding:"+p)}}}return n.onResponse=n.onResponse||t,n.onResponse===!0&&(n.onResponse=i,n.callback=t),!n.headers.authorization&&n.auth&&(n.headers.authorization="Basic "+s(n.auth.username+":"+n.auth.password)),r(n)}function r(r){function t(){f=!0;var t=new Error("ETIMEDOUT");return t.code="ETIMEDOUT",t.duration=r.timeout,e.log.error("Timeout",{id:d._id,milliseconds:r.timeout}),r.callback(t,d)}function o(t){if(f)return e.log.debug("Ignoring timed out state change",{state:d.readyState,id:d.id});if(e.log.debug("State change",{state:d.readyState,id:d.id,timed_out:f}),d.readyState===a.OPENED){e.log.debug("Request started",{id:d.id});for(var o in r.headers)d.setRequestHeader(o,r.headers[o])}else d.readyState===a.HEADERS_RECEIVED?n():d.readyState===a.LOADING?(n(),s()):d.readyState===a.DONE&&(n(),s(),u())}function n(){if(!g.response){if(g.response=!0,e.log.debug("Got response",{id:d.id,status:d.status}),clearTimeout(d.timeoutTimer),d.statusCode=d.status,l&&0==d.statusCode){var t=new Error("CORS request rejected: "+r.uri);return t.cors="rejected",g.loading=!0,g.end=!0,r.callback(t,d)}r.onResponse(null,d)}}function s(){g.loading||(g.loading=!0,e.log.debug("Response body loading",{id:d.id}))}function u(){if(!g.end){if(g.end=!0,e.log.debug("Request done",{id:d.id}),d.body=d.responseText,r.json)try{d.body=JSON.parse(d.responseText)}catch(t){return r.callback(t,d)}r.callback(null,d,d.body)}}var d=new a,f=!1,l=i(r.uri),p="withCredentials"in d;if(c+=1,d.seq_id=c,d.id=c+": "+r.method+" "+r.uri,d._id=d.id,l&&!p){var h=new Error("Browser does not support cross-origin request: "+r.uri);return h.cors="unsupported",r.callback(h,d)}d.timeoutTimer=setTimeout(t,r.timeout);var g={response:!1,loading:!1,end:!1};return d.onreadystatechange=o,d.open(r.method,r.uri,!0),l&&(d.withCredentials=!!r.withCredentials),d.send(r.body),d}function t(){}function o(){var e,r,o={},i=["trace","debug","info","warn","error"];for(r=0;r<i.length;r++)e=i[r],o[e]=t,"undefined"!=typeof console&&console&&console[e]&&(o[e]=n(console,e));return o}function n(e,r){function t(t,o){return"object"==typeof o&&(t+=" "+JSON.stringify(o)),e[r].call(e,t)}return t}function i(e){var r,t=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{r=location.href}catch(o){r=document.createElement("a"),r.href="",r=r.href}var n=t.exec(r.toLowerCase())||[],i=t.exec(e.toLowerCase()),s=!(!i||i[1]==n[1]&&i[2]==n[2]&&(i[3]||("http:"===i[1]?80:443))==(n[3]||("http:"===n[1]?80:443)));return s}function s(e){var r,t,o,n,i,s,a,u,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0,f=0,l="",p=[];if(!e)return e;do r=e.charCodeAt(d++),t=e.charCodeAt(d++),o=e.charCodeAt(d++),u=r<<16|t<<8|o,n=u>>18&63,i=u>>12&63,s=u>>6&63,a=63&u,p[f++]=c.charAt(n)+c.charAt(i)+c.charAt(s)+c.charAt(a);while(d<e.length);switch(l=p.join(""),e.length%3){case 1:l=l.slice(0,-2)+"==";break;case 2:l=l.slice(0,-1)+"="}return l}var a=XMLHttpRequest;if(!a)throw new Error("missing XMLHttpRequest");e.log={trace:t,debug:t,info:t,warn:t,error:t};var u=18e4,c=0;e.withCredentials=!1,e.DEFAULT_TIMEOUT=u,e.defaults=function(r,t){var o=function(e){var t=function(t,o){t="string"==typeof t?{uri:t}:JSON.parse(JSON.stringify(t));for(var n in r)void 0===t[n]&&(t[n]=r[n]);return e(t,o)};return t},n=o(e);return n.get=o(e.get),n.post=o(e.post),n.put=o(e.put),n.head=o(e.head),n};var d=["get","put","post","head"];return d.forEach(function(r){var t=r.toUpperCase(),o=r.toLowerCase();e[o]=function(r){"string"==typeof r?r={method:t,uri:r}:(r=JSON.parse(JSON.stringify(r)),r.method=t);var o=[r].concat(Array.prototype.slice.apply(arguments,[1]));return e.apply(this,o)}}),e.couch=function(r,o){function n(e,r,t){if(e)return o(e,r,t);if((r.statusCode<200||r.statusCode>299)&&t.error){e=new Error("CouchDB error: "+(t.error.reason||t.error.error));for(var n in t)e[n]=t[n];return o(e,r,t)}return o(e,r,t)}"string"==typeof r&&(r={uri:r}),r.json=!0,r.body&&(r.json=r.body),delete r.body,o=o||t;var i=e(r,n);return i},e})},{}],2:[function(e,r,t){"use strict";var o=e("browser-request"),n=window.popily||{},i=function(e,r){return{msg:e,error:r}},s=function(e,r,t,s){var a="https://popily.com",u="/api",c=n.api.apiUrl;n.api.apiUrl||(c=a),c+=u;var d={method:e,headers:{Authorization:"Token "+n.api.token,Accept:"application/json"},url:c+r};"qs"in t&&(d.qs=t.qs,d.json=!0),"json"in t&&(d.body=t.json,d.json=!0),"form"in t&&(d.formData=t.form),o(d,function(e,r,t){if(e)return s(i("Request error",e));if(401===r.statusCode)return s(i("Invalid API token"));if(400===r.statusCode)return s(i("Bad request",t));try{var o=t;"string"==typeof t&&(o=JSON.parse(t))}catch(n){return s(i("Error: "+n,n))}s(null,o)})},a=function(e){var r="";return e.forEach(function(e,t){var o="";t>0&&(o+="__"),o+=e.column+"!"+e.calculation,r+=o}),r};n.api={getInteresting:function(e,r){s("POST","/interesting/describe/",{json:{columns:e}},r)},addSource:function(e,r){var t={};["columns","title","description"].forEach(function(r){r in e&&(t[r]=e[r])}),"url"in e?(t.url=e.url,s("POST","/sources/",{json:t},r)):"connection_string"in e?(t.connection_string=e.connection_string,t.query=e.query,s("POST","/sources/",{json:t},r)):r("url or connection_string is required")},getSources:function(e){s("GET","/sources/",{},e)},getSource:function(e,r){s("GET","/sources/"+e+"/",{},r)},getInsights:function(e,r,t){r=r||{};var o={source:e};["columns","insight_types","insight_actions"].forEach(function(e){e in r&&(o[e]=r[e].join(","))}),"single"in r&&(o.single=r.single),"calculations"in r&&(o.calculations=a(r.calculations)),s("GET","/insights/",{qs:o},t)},getOverview:function(e,r,t){r=r||{};var o={source:e};["columns","insight_types","insight_actions"].forEach(function(e){e in r&&(o[e]=r[e].join(","))}),"calculations"in r&&(o.calculations=a(r.calculations)),s("GET","/insights/overview/",{qs:o},t)},getInsight:function(e,r,t){var o={};s("GET","/insights/"+e+"/",{qs:o},t)},setToken:function(e){this.token=e},setURL:function(e){this.apiUrl=e}},window.popily=n,r.exports=n},{"browser-request":1}]},{},[2]);